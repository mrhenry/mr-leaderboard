<h1><%= @leaderboard.title %> (<%= pluralize(@leaderboard.games.count, 'played game')%>)</h1>

<h2>Leaderboard users</h2>
<% unless @leaderboard.users.empty? %>
  
  <ul class="users">
    <% @leaderboard.users.each do |user| %>
      <li>
        <%= image_tag gravatar(user.email, 50) %>
        <%= user.display_name %>
        <%= membership_score(user) %> 
        <% if membership_played_sets(user) > 0 %>
          (<%= (Float(membership_score(user)) / Float(membership_played_sets(user)) * 100).round %>% win percentage)
        <% end %>
      </li>
    <% end %>
  </ul>
  
<% else %>

  <p>There are no user in this leaderboard.</p>
  <% if current_user and current_user.is_admin? %>
    <%= link_to "Add users to leaderboard", edit_leaderboard_url(params[:id]) %>
  <% end %>
  
<% end %>

<h2>Played games</h2>
<% unless @leaderboard.games.empty? %>
  
  <ul class="games">
    <% @leaderboard.games.each do |game| %>
      <li>
        <%= link_to game.created_at, leaderboard_game_url(@leaderboard.id, game.id) %>
        <% unless game.scores.empty? %>
          <%= User.find(game.scores[0].user_id).display_name %> [<%= game.scores[0].score %>] -
          [<%= game.scores[1].score rescue '...' %>] <%= User.find(game.scores[1].user_id).display_name rescue '...' %>
        <% else %>
          No scores added
        <% end %>
        <% if current_user and current_user.is_admin? %>
          <%= link_to "Destroy", leaderboard_game_url(@leaderboard, game.id), :method => :delete, :confirmation => "You sure?" %>
        <% end %>
      </li>
    <% end %>
  </ul>
  
<% else %>

  No games added yet.
  
<% end %>

<% if current_user and @leaderboard.users.count > 2 %>
  <p><%= link_to "Add game", new_leaderboard_game_url(params[:id]) %></p>
<% end %>

<p><%= link_to "Back to leaderboard overview", leaderboards_url %></p>